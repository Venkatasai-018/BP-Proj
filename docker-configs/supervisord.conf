[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log

[program:postgresql]
command=/usr/lib/postgresql/13/bin/postgres -D /var/lib/postgresql/13/main -c config_file=/etc/postgresql/13/main/postgresql.conf
user=postgres
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/postgresql.log
priority=100

[program:fastapi]
command=/usr/local/bin/uvicorn main:app --host 127.0.0.1 --port 8000
directory=/app
user=root
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/fastapi.log
environment=DATABASE_URL="postgresql://bus_user:bus_password@localhost:5432/bus_tracking",SECRET_KEY="ec2-production-secret-key-change-this",ACCESS_TOKEN_EXPIRE_MINUTES="60"
priority=200

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/nginx.log
priority=300